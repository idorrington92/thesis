% ------------------------------------------------------------------------------------------------------------------
% Last edited: 23 Feb 2006, Gustav Teleberg
%
% The original file (XThesis_mod) is here modified to suit a Thesis for Cardiff University.
% The comments below by Dalhousie, Stanford and Steven Matheson may or may not be valid anymore. 
% Some commands defined below will have no effect anymore and some of them may course problems.
% My modifications have only been tested for Miktex 2.4. 
% Feel free to make any changes you like but dont blame me!
%
% For best results, use this file together with Cardiff_Thesis_Template.tex and fancyhdr_mod.sty
% At the very least, your preamble should include:
%
% \documentclass[12pt,twoside,a4paper]{report}
% \usepackage{titlesec}                                     %To change the appearance of chapters/sections
% \usepackage{titletoc}
% \usepackage{setspace}                                     %Enables commands: \singlespacing, \onehalfspacing
% \usepackage{fancyhdr_mod}                                 %Defines proper headers suitable for a thesis
% \usepackage{cardiff_thesis}                               %Cardiff Thesis style
% \usepackage[square,comma,numbers,sort&compress]{natbib}
% \bibliographystyle{thesis}                                %Thesis bibliography style
% -----------------------------------------------------------------------------------------------------------------
%
%
%
%
%
% Dalhousie University thesis style
% Dept. of Math. Stats. and Comp. Sci.
%
% Modification of:
%
%-% Stanford University PhD thesis style -- modifications to the report style
%-% For LaTeX version 2.09
%-% Last edit Tue Sep 13 14:40:26 1988
%-% Last edit by Joseph Pallas
%
% Modifications by Steven Matheson, May 1990
%       - Changed baselinestretch to 1.37.
%       - Changed \dept default to MS&CS and other name changes.
%       - Allow user to specify university and faculty
%       - Changed page headings to be page number only, except on
%         the first page of each chapter (page number at bottom).
%       - Redefined title and signature page.
%       - Added optional permission page (formly supplied by
%         Graduate Studies).  Page skipped if omitted.
%       - User can define degree to be recieved.
%         \msc (default), \ma, and \phd provided.
%       - Signature page slightly different for Ph.D.
%       - Two to three readers' signatures for Masters thesis,
%         three to five readers' signatures for Ph.D.
%       - Convocation date is either given or calculated.
%       - Two supervisors supported.
%       - Added dedication page environment.
%       - List of tables and figures recorded in table of
%         contents.
%       - User can omit front material or bibliography for
%         draft printing purposes.
%       - User can specify draft copies, "draft copy" and date
%         printed on title page and headers.
%       Bugs:
%       - TeX complains too much about the front material, ignore
%         under/overfull box messages on pages ii and iii.
%         (Better yet, can somebody fix this?)
%       - Cannot handle department name more than 4-5 characters
%         longer than MS&CS (does one exist?).
%       - Occassional screw ups when adding diferent university,
%         department and faculty names.
%       - Would also have difficultly with very long author names.
%
% Modifications by Steven Matheson, Sept 1992
%       - Added the forgotten `` \\'' after thrid signature on signature page,
%         caused third and fourth signatures to be too close.
%
% Last edit Sept. 11, 1992
%

\typeout{Document Style Option `dalthesis'.}

\long\def\comment#1{}
\comment{

  Example of use:
    \documentstyle[12pt,dalthesis]{report}
    \begin{document}
    \title{How to Write Theses\\
        With Two Line Titles}
    \author{John Henry Candidate}
    \supervisor{John Parker}
    \firstreader{John Green}
    \secondreader{John BigBooty}

    \dedicate{
    This is the optional\\
    dedication page.\\
    Break lines up\\
    like this.
    }

    \beforepreface

    \prefacesection{Abstract}
    An abstract is required in all theses.  Make sure that it fits
    on one page!

    \afterpreface

    \chapter{Introduction}
     ...
    \chapter{Conclusions}
     ...
    \appendix
    \chapter{A Long Proof}
     ...
    \bibliographystyle{plain}
    \bibliography{mybib}
    \end{document}

Documentation:
    This style file modifies the standard report style to follow the
    Dalhousie University Faculty of Graduate Studies' "Regulations for
    Submission of Theses".  It sets the margins and required interline
    spac\lesssiming and disallows page breaks at hyphens.

    The \beforepreface command creates the title page, a signature page,
    and a permission page (optionally).  Then the user should put
    preface section(s), using the \prefacesection{section title}
    command.  The \afterpreface command then produces the tables of
    contents, tables and figures (optionally), and sets things up to
    start the main body (on arabic page 1).

    The following commands control the typesetting of your thesis:

   Basic Information:

    \title{thesis title}
        - Will appear in large print on page i.  If it is too
          long it will automatically be split into separate
          lines.  If you wish to specify line breaks, use the
          \\ command inside the title.
          \title{Very Long\\Title\\Split Over\\Several Lines}
          Make sure that there is no space before \\.

    \author{author's name}
        - Your name as you wish it to appear in the thesis.

   Graduation and Submission Information:

    \submitdate{month year in which submitted to Graduate Studies}
        - date LaTeX'd if omitted

    \copyrightyear{year thesis}
        - year LaTeX'd if omitted

    \convocation{month}{year}
        - Date set to next May or Oct. after \submitdate if omitted

   Degree Specification:

    \msc
        - Degree to obtain is Master of Science, M.Sc. (default)
    \ma
        - Degree to obtain is Master of Arts, M.A.
    \phd
        - Degree to obtain is Doctor of Philosophy, Ph.D.

   Signatures:

    \examiner{the external examiner's name}
        - Use only for Ph.D.
    \supervisor{the supervisor's name}
        - Include research supervisor's name.
    \firstreader{the first reader's name}
        - Include the first reader's name.
    \secondreader{the second reader's name}
        - Include the second reader's name.
    \thirdreader{the third reader's name}
        - Omit this command if only two readers (typical M.Sc. case)
        - Ph.D. cases usually have at least three readers
    \fourthreader{the third reader's name}
        - Omit this command if not required (typical Ph.D. case)
    \fifthreader{the third reader's name}
        - Omit this command if not required (typical Ph.D. case)

    Sorry, provisions has been made to allow only seven signatures.


   Sectioning commands::

    \dedicate{
      First line\\
      second line\\
      last line.
    }
        - Produces the optional dedication page.  Must be placed
          before the \beforepreface command.

    \prefacesection{Whatever}
    Blah, blah, blah...
        - Produces a preface section, such as abstract,
          acknowledgments, etc.  This must appear between
          \beforepreface and \afterpreface commands.
          Typeset similar to chapters, not numbered.

    \chapter{Whatever}
    Blah, blah, blah...
        - Produce a numbered chapter section.

    \section{Section name}
        - Place prior to a section of a given chapter.

    \subsection{Subsection name}
        - Place prior to a subsection of a given section.

    \appendix
        - Place this command before your first appendix chapter.
          Use the \chapter command thereafter.  These will be
          lettered, not numbered.

    \nonumchapter{Whatever}
    Blah, blah, blah...
        - Produces a chapter section that is not to be numbered,
          such as an introduction chapter.  This is used in the
          same way as the \chapter command.

   Printing draft copies:

    \draft
        - For printing draft copies of the thesis.  Specifies
          on page headers that the copy is draft and specifies
          the date printed.  Also specifies draft and date on
          the title page.
    \nofront
        - Specifies not to print the signature and permission
          pages, table of contents, and the lists of figures and
          tables.  Useful for draft copies to cut done on printing.
    \nobib
        - Suppresses the printing of the bibliiography.
          Useful for draft copies to cut done on printing.

   Specialized commands:

    \nolistoffigures
        - don't produce a List of Figures
    \nolistoftables
        - don't produce a List of Tables
    \twosupervisors
        - Use if you have two cosupervisors instead of one supervisor.
          Name given by \supervisor{} will go first, \firstreader{}
          will be second.  Can be used with Ph.D. format.
    \univerity{name of university}
        - ``Dalhousie University'' default.  Can specify line breaks
          for larger names.
    \address{university address}
        - ``Halifax, Nova Scotia'' default.
    \dept{author's department}
        - ``Mathematics Statistics and Computing Science'' default
    \faculty{degree granting faculty}
        - [Faculty of] ``Graduate Studies'' default
    \degree{Full Degree Title}
    \degreeinitial{F.D.T.}
        - Specify degree name and initials
          \degree{Master of Business Administration}
          \degreeinitial{M.B.A.}
    \permissionfalse
        - don't produce a permission page (true by default)

This style uses interline spacing that is 1.37 times normal, except
in the figure and table environments where normal spacing is used.
That can be changed by doing:

    \renewcommand{\baselinestretch}{1.0} %1.5
(or whatever you want instead of 1.5)

Unfortunately, that command probably won't take effect unless it comes
before the \begin{document} or after a type size changing command like
\small or \normalsize.

The example above shows the 12pt substyle being used.  This is required
for submission copy, but it may be omitted to get smaller draft print.
Note that the front material may not look good in smaller print.

}

\renewcommand\contentsname{Contents}

\newcommand\tbleofcontents{%
    \chapter*{\contentsname
        \@mkboth{%
           \MakeUppercase\contentsname}{\MakeUppercase\contentsname}}%
    \vspace{-5mm}\@starttoc{toc}%
    }


% Define the page heading to be page number only.
\newcommand{\properpagestyle}{
       \pagestyle{myheadings}\markboth{}{}\markright{}}

% First thing we do is make sure that report has been loaded.  A
% common error is to try to use suthesis as a documentstyle.
\@ifundefined{chapter}{\@latexerr{The `dalthesis' option should be used
with the `report' document style}{You should probably read the
dalthesis documentation.}}{}

% We need 1" margins except on the binding edge, where it is 1 1/2"
% Theses are single-sided, so we don't care about \evensidemargin
\oddsidemargin 0.4in \evensidemargin -0.1in
\marginparwidth 40pt \marginparsep 10pt
\topmargin -0.25in 
\headsep 0.5in
\textheight 9.2in \textwidth 6in
\headheight 0in

% Disallow page breaks at hyphens (this will give some underfull vbox's,
% so an alternative is to use \brokenpenalty=100 and manually search
% for and fix such page breaks)
\brokenpenalty=10000

% Use 1.37 times the normal baseline-to-baseline skip
\renewcommand{\baselinestretch}{1.0} %1.37

% Redefine the macro used for floats (including figures and tables)
% so that single spacing is used.
% (Note \def\figure{\@float{figure}set single spacing} doesn't work
%  because figure has an optional argument)
\def\@xfloat#1[#2]{\ifhmode \@bsphack\@floatpenalty -\@Mii\else
   \@floatpenalty-\@Miii\fi\def\@captype{#1}\ifinner
      \@parmoderr\@floatpenalty\z@
    \else\@next\@currbox\@freelist{\@tempcnta\csname ftype@#1\endcsname
       \multiply\@tempcnta\@xxxii\advance\@tempcnta\sixt@@n
       \@tfor \@tempa :=#2\do
            {\if\@tempa h\advance\@tempcnta \@ne\fi
             \if\@tempa t\advance\@tempcnta \tw@\fi
             \if\@tempa b\advance\@tempcnta 4\relax\fi
             \if\@tempa p\advance\@tempcnta 8\relax\fi
     }\global\count\@currbox\@tempcnta}\@fltovf\fi
    \global\setbox\@currbox\vbox\bgroup
    \def\baselinestretch{1}\@normalsize
    \boxmaxdepth\z@
    \hsize\columnwidth \@parboxrestore}

% Redefine the macro used for footnotes to use single spacing
\long\def\@footnotetext#1{\insert\footins{\def\baselinestretch{1}\footnotesize
    \interlinepenalty\interfootnotelinepenalty
    \splittopskip\footnotesep
    \splitmaxdepth \dp\strutbox \floatingpenalty \@MM
    \hsize\columnwidth \@parboxrestore
   \edef\@currentlabel{\csname p@footnote\endcsname\@thefnmark}\@makefntext
    {\rule{\z@}{\footnotesep}\ignorespaces
      #1\strut}}}

% \author, \title are defined in report; here are the rest of the
% front matter defining macros
\def\university#1{\gdef\@university{#1}}
\def\address#1{\gdef\@address{#1}}
\def\dept#1{\gdef\@dept{#1}}
\def\faculty#1{\gdef\@faculty{#1}}
\def\supervisor#1{\gdef\@supervisor{#1}}
\def\superviser#1{\gdef\@supervisor{#1}}
\def\firstreader#1{\gdef\@firstreader{#1}}
\def\secondreader#1{\gdef\@secondreader{#1}}
\def\thirdreader#1{\gdef\@thirdreader{#1}\third@readertrue}
\def\fourthreader#1{\gdef\@fourthreader{#1}\fourth@readertrue}
\def\fifthreader#1{\gdef\@fifthreader{#1}\fifth@readertrue}
\def\examiner#1{\gdef\@examiner{#1}}
\def\twosupervisors{\two@supervisorstrue}
\def\submitdate#1{\gdef\@submitdate{#1}}
\def\copyrightyear#1{\gdef\@copyrightyear{#1}} % \author, \title in report
\def\degree#1{\gdef\@degree{#1}}
\def\degreeinitial#1{\gdef\@degreeinitial{#1}}
\def\msc{\degree{Master of Science}\degreeinitial{M.Sc.}}
\msc % default degree
\def\phd{\degree{Doctor of Philosophy}\degreeinitial{Ph.D.}\ph@dtrue}
\def\ma{\degree{Master of Arts}\degreeinitial{M.A.}}
\def\@title{}
\def\@author{}
\def\@university{Dalhousie University}
\def\@address{Halifax, Nova Scotia}
\def\@dept{Mathematics Statistics and Computing Science}
\def\@faculty{Graduate Studies}
\def\@supervisor{}\def\@firstreader{}\def\@secondreader{}
\def\@thirdreader{}\def\@fourthreader{}\def\@fifthreader{}
\def\@examiner{}
\def\@submitdate{\ifcase\the\month\or
  January\or February\or March\or April\or May\or June\or
  July\or August\or September\or October\or November\or December\fi
  \space \number\the\year}
\def\@copyrightyear{\number\the\year}

\def\convocation#1#2{\gdef\@convocationmonth{#1}\gdef\@convocationyear{#2}}
\def\@convwarn{\typeout{Warning!  Convocation date may be incorrect!}}
\ifnum\month<5
   \def\@convocationmonth{May}
   \def\@convocationyear{\number\the\year\@convwarn}
\else\ifnum\month<10
   \def\@convocationmonth{October}
   \def\@convocationyear{\number\the\year\@convwarn}
\else
   \def\@convocationmonth{February}
   \@tempcnta=\year  \advance\@tempcnta by 1
   \def\@convocationyear{\number\the\@tempcnta\@convwarn}
\fi\fi

\def\dedicate#1{\dedic@tiontrue\gdef\dedication@text{#1}}

\def\draft{\renewcommand{\properpagestyle}{\pagestyle{myheadings}
\markright{{\rm Draft Version -- \today}}}\draft@modetrue\properpagestyle}
\def\nobib{\print@bibfalse}
\def\nolistoffigures{\figurespagefalse}
\def\nolistoftables{\tablespagefalse}
\def\nofront{\front@pagesfalse\permissionfalse\figurespagefalse\tablespagefalse}

% New if constructs:    Default conditions:
\newif\ifpermission     \permissiontrue
\newif\iffigurespage    \figurespagetrue
\newif\iftablespage     \tablespagetrue
\newif\iffront@pages    \front@pagestrue
\newif\ifthird@reader   \third@readerfalse
\newif\iffourth@reader  \fourth@readerfalse
\newif\iffifth@reader   \fifth@readerfalse
\newif\ifph@d           \ph@dfalse
\newif\iftwo@supervisors \two@supervisorsfalse
\newif\ifdraft@mode     \draft@modefalse
\newif\ifprint@bib      \print@bibtrue
\newif\ifdedic@tion     \dedic@tionfalse

\def\no@breaks#1{{\def\\{ \ignorespaces}#1}}    % disallow explicit line breaks

\def\titlep{    
\thispagestyle{empty}%
    \ifdraft@mode
      \begin{center} \Large DRAFT COPY\\ \large Printed \today \end{center}
    \fi
    \null\vskip0.5in
    \begin{center}
    \begin{quote}     \hrule\vspace{0.1in}\end{quote}
       \hyphenpenalty=10000\Large\scshape\expandafter{\@title}
   \begin{quote}     \vspace{0.3in}\hrule\end{quote}
    \end{center}
    \vfill
    \begin{center}
        \large %By\\
        \@author
    \end{center}
    \vfill
    \vfill
    \vfill
    \begin{center}
        \normalsize\scshape A Thesis submitted to\\
        \expandafter{\@university} \\
        for the degree of\\
        \expandafter{\@degree} \\
        \bigskip\bigskip
        \expandafter{\@submitdate}
    \end{center}
%Copyright stuff
%    \vskip0.75in
%    \begin{center}
%        \rm \copyright\ Copyright \@copyrightyear \space \@author
%    \end{center}
 \newpage}

\def\signature#1#2{\parbox[b]{1in}{\smash{#1}\vskip12pt}
\hfill \parbox[t]{3in}{\shortstack{\vrule width 3in height 0.4pt\\\small#2}}}

\def\signaturepage{%
    \setcounter{page}{3}
    \begin{quotation}
    \begin{center}
        \LARGE \sc \bf Declaration
    \end{center}
    \vfill\vfill\noindent 
     This work has not previously been accepted in
     substance for any degree and is not being
     concurrently submitted in candidature for
     any degree.\\
     \vfill\vfill
     \signature{\bf Signed:}{Candidate}
     \vfill\vfill
     \signature{\bf Date:}{}
     \vfill\vfill
    \begin{center}
        {\LARGE \sc \bf Statement 1}
    \end{center}
    \vfill\noindent
    This thesis is the result of my own investigations, except where otherwise stated.
    Other sources are acknowledged by giving explicit references. A bibliography is appended.
     \vfill\vfill\vfill
     \signature{\bf Signed:}{Candidate}
     \vfill\vfill
     \signature{\bf Date:}{}
     \vfill\vfill
    \begin{center}
        \LARGE \sc \bf Statement 2
    \end{center}
    \vfill\noindent
    I hereby give consent for my thesis, if accepted, to be available for photocopying and
    for inter-library loan, and for the title and summary to be available to outside organisations.
     \vfill\vfill\vfill
     \signature{\bf Signed:}{Candidate} \\
     \vfill
     \signature{\bf Date:}{}
     \vfill\vfill
    \end{quotation}
    }

\def\permissionpage{%
    {\newpage \thispagestyle{empty}\null
     }\pagebreak}



\def\beforepreface{
\typeout{Most over/underfulls in first few pages are the fault of dalthesis.}
\typeout{Ignore all them.  If uncorrectable errors occur, notify staff.}
    \pagenumbering{roman}
    \pagestyle{plain}
    \titlep
    \ifpermission\permissionpage\else\addtocounter{page}{1}\fi
    \iffront@pages\signaturepage\else\addtocounter{page}{1}\fi
    \iffront@pages\ifdedic@tion
        \newpage\null\pagebreak\begin{flushright}\Large\null\vskip1in
        \dedication@text
        \vfill\end{flushright}
    \fi\fi\newpage\null
%

%    \newpage
%    \iftablespage
%        \addcontentsline{toc}{chapter}{List of Tables}\listoftables
%        \newpage
%    \fi
%    \iffigurespage
%        \addcontentsline{toc}{chapter}{List of Figures}\listoffigures
%        \cleardoublepage
%    \fi
    }

\def\nonumchapter#1{%
    \chapter*{#1}
    \addcontentsline{toc}{chapter}{#1}}

\def\prefacesection#1{%
    \chapter*{#1}
%    \addcontentsline{toc}{chapter}{#1} %comment this out to get rid of preface stuff from contents
}


\newenvironment{dedication}{\newpage\begin{flushright}\Large\em\null\vskip1in}%
{\vfill\end{flushright}}

%Fancyheaders
%\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
%\renewcommand{\sectionmark}[1]{\markright{\MakeUppercase{#1}}{}}
%\renewcommand{\headrulewidth}{0pt}
\newcommand{\tstamp}{\today}   
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}

\def\afterpreface{\newpage
    \fancyhf{}
    \pagenumbering{arabic}
    \newpage
    \iffront@pages\tbleofcontents\else\addtocounter{page}{1}\fi
   % \typeout{Dalthesis preface pages completed.}
   \properpagestyle
   \pagestyle{fancy}

   %\rhead{Right top} \chead{Middle top} \lhead{Left top} \rfoot{Right bottom}
   %\cfoot{\thepage} \lfoot{Left bottom}
    \lhead[\thepage]{\rightmark}      
    \rhead[\leftmark]{\thepage}
% 
     \newpage
    \iftablespage
        \addcontentsline{toc}{chapter}{List of Tables}\listoftables
        \newpage
    \fi      
       \iffigurespage
        \addcontentsline{toc}{chapter}{List of Figures}\listoffigures
        \cleardoublepage
    \fi
%   
   }
   


% Redefine \thebibliography to go to a new page and put an entry in the
% table of contents
\let\@ldthebibliography\thebibliography
\renewcommand{\thebibliography}[1]{%
    \newpage
    \addcontentsline{toc}{chapter}{Bibliography}
    \@ldthebibliography{#1}
}

\let\@ldbibliography\bibliography
\renewcommand{\bibliography}[1]{\ifprint@bib\@ldbibliography{#1}\fi}

% Start out normal
%\properpagestyle

\font\tenhv  = phvb7t at 10pt
\newlength{\@ctmp}
\newlength{\@figindent}
\setlength{\@figindent}{1pc}

\long\def\@makecaption#1#2{
   \vskip 10pt
   \setbox\@tempboxa\hbox{\small\textrm{\noindent #1:}\small~#2}
   \setlength{\@ctmp}{\hsize}
   \addtolength{\@ctmp}{-\@figindent}\addtolength{\@ctmp}{-\@figindent}
   % IF longer than one indented paragraph line
   \ifdim \wd\@tempboxa >\@ctmp
      % THEN set as an indented paragraph
      \begin{list}{}{\leftmargin\@figindent \rightmargin\leftmargin}
         \item[]\small\textrm{#1:}\small~#2\par
      \end{list}
   \else
      % ELSE center
      \hbox to\hsize{\hfil\box\@tempboxa\hfil}
   \fi}


% correct heading spacing and type
\def\section{\@startsection {section}{1}{\z@}
   {20pt plus 4pt minus 4pt}{10pt plus 4pt minus 4pt} {\sc \Large}}
\def\subsection{\@startsection {subsection}{2}{\z@}
   {20pt plus 4pt minus 4pt}{10pt plus 4pt minus 4pt} {\sc \large}}
\parindent=0.5in

\hfuzz2pt     % Don't bother to report over-full boxes if over-edge is < 2pt
\typeout{\space} 
\typeout{Modifications to the XThesis_mod style file by GUSTAV TELEBERG}
\typeout{\space}

%Redefine cleardoublepage
\makeatletter
    \def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else%
        \hbox{}%
        \thispagestyle{empty}%             
        \newpage%
        \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
